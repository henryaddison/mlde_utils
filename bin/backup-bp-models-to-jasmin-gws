#!/bin/bash
# Sync models (including samples) for backup from BluePebble to GWS on JASMIN

set -euo pipefail

model_type="score-sde"

function backupmodels {
  local model_type=${1}
  local depth=${2}

  local src_root="/user/work/vf20964/workdirs/${model_type}"
  local destination="xfer1.jasmin:/gws/nopw/j04/bris_climdyn/henrya/bp-backups/moose/workdirs/${model_type}"

  cd ${src_root}
  local srcs=$(find . -maxdepth ${depth} -mindepth ${depth} -type d)
  for src in ${srcs[@]}; do
    if [[ "${src}" = *"archive"* ]]; then
      continue;
    fi;
    set -x
    rsync -avz ${src} ${destination}
    set +x
  done
}

backupmodels("score-sde", 3)
backupmodels("u-net", 1)
